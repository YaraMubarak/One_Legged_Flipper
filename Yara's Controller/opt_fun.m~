function [cost] = opt_fun(x) 
%x(1) = dx_desired 
%x(2) = height_desired
%x(3) = slack_variable for desired_length 
[dt, time, x ,y, xd, yd , hip_torque, leg_angle, body_angle, ...
    leg_angled, body_angled, leg_state, foot_x , foot_y , leg_length, leg_lengthd,...
    rest_leg_length, control_state, height_desired, leg_angle_desired, last_bounce_time, ... 
    last_touchdown_time, last_takeoff_time, max_height, last_max_height, speed_desired, ytakeoff, jump_counter] = loadglobal() ; 
height_desired = x(2) ; 
speed_desired = x(1) ; 
prev_state = 1 ; 
jump_counter = 0 ; 


while jump_counter <= 3 
    %simulate 
    [dt, time, x ,y, xd, yd , hip_torque, leg_angle, body_angle, ...
    leg_angled, body_angled, leg_state, foot_x , foot_y , leg_length, leg_lengthd,...
    rest_leg_length, control_state, height_desired, leg_angle_desired, last_bounce_time, ... 
    last_touchdown_time, last_takeoff_time, max_height, last_max_height, speed_desired, ytakeoff] =...
    simulate4opt(dt, time, x ,y, xd, yd , hip_torque, leg_angle, body_angle, ...
    leg_angled, body_angled, leg_state, foot_x , foot_y , leg_length, leg_lengthd,...
    rest_leg_length, control_state, height_desired, leg_angle_desired, last_bounce_time, ... 
    last_touchdown_time, last_takeoff_time, max_height, last_max_height, speed_desired, ytakeoff);
  %control 
   [dt, time, x ,y, xd, yd , hip_torque, leg_angle, body_angle, ...
    leg_angled, body_angled, leg_state, foot_x , foot_y , leg_length, leg_lengthd,...
    rest_leg_length, control_state, height_desired, leg_angle_desired, last_bounce_time, ... 
    last_touchdown_time, last_takeoff_time, max_height, last_max_height, speed_desired, ytakeoff] =...
    simulate4opt(dt, time, x ,y, xd, yd , hip_torque, leg_angle, body_angle, ...
    leg_angled, body_angled, leg_state, foot_x , foot_y , leg_length, leg_lengthd,...
    rest_leg_length, control_state, height_desired, leg_angle_desired, last_bounce_time, ... 
    last_touchdown_time, last_takeoff_time, max_height, last_max_height, speed_desired, ytakeoff);

[jump_end] = 
end 



